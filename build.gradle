apply plugin: 'java'
group 'org.metalscraps.eso.lang'
version '1.0'
sourceCompatibility = 11
compileJava.options.encoding = "UTF-8"
compileTestJava.options.encoding = "UTF-8"


repositories {
    mavenCentral()
}

subprojects {

    apply plugin: 'java'
    group 'org.metalscraps.eso.lang'
    version '1.0'
    sourceCompatibility = 11
    compileJava.options.encoding = "UTF-8"
    compileTestJava.options.encoding = "UTF-8"

    repositories {
        mavenCentral()
    }

    jar { from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } } }

    dependencies {

        // https://mvnrepository.com/artifact/org.projectlombok/lombok
        // 안되면 compile group 해보셈
        compile group: 'org.projectlombok', name: 'lombok', version: '1.18.4'

        testCompile group: 'junit', name: 'junit', version: '4.12'

        // https://mvnrepository.com/artifact/ch.qos.logback/logback-classic
        compile group: 'ch.qos.logback', name: 'logback-classic', version: '1.2.3'
    }
}

project(':server') {
    jar.manifest { attributes 'Main-Class': 'org.metalscraps.eso.lang.server.ServerMain' }

    dependencies {
        compile project(':library')
        compile 'com.google.apis:google-api-services-compute:v1-rev199-1.25.0'
    }
}
project(':compress-server') {
    jar.manifest { attributes 'Main-Class': 'org.metalscraps.eso.lang.server.compress.CompressServerMain' }

    dependencies { compile project(':library') }
}

project(':client') {

    ext {
        moduleName = 'org.metalscraps.eso.lang.client'
        moduleLaunchPoint = 'org.metalscraps.eso.lang.client.ClientMain'
    }

    task jlink(type: Exec, dependsOn: ['clean', 'jar']) {
        def javaHome = System.properties.'java.home'

        workingDir 'build'

        commandLine "${javaHome}/bin/jlink", '--module-path', "libs${File.pathSeparatorChar}${javaHome}/jmods",
                '--strip-debug', '--no-header-files', '--no-man-pages', '--compress', '2',
                '--add-modules', "${moduleName}",
                '--launcher', "launch=${moduleName}/${moduleLaunchPoint}",
                '--output', 'dist'
    }

    jar.manifest { attributes 'Main-Class': 'org.metalscraps.eso.lang.client.ClientMain' }

    dependencies {
        compile project(':library')

        // https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind
        compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.9.8'
    }
}
project(':tool') {
    jar.manifest { attributes 'Main-Class': 'org.metalscraps.eso.lang.kr.ToolMain' }

    dependencies {
        compile project(':library')

        // https://mvnrepository.com/artifact/org.apache.commons/commons-lang3
        compile group: 'org.apache.commons', name: 'commons-lang3', version: '3.7'

        // https://mvnrepository.com/artifact/org.apache.commons/commons-text
        compile group: 'org.apache.commons', name: 'commons-text', version: '1.2'

        compile 'org.apache.httpcomponents:httpclient:4.5.5'

        compile 'com.google.cloud:google-cloud-translate:1.14.0'

        compile group: 'org.jsoup', name: 'jsoup', version: '1.11.2'

    }
}
project(':library') {
    dependencies {

        // https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind
        compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.9.8'

        // https://mvnrepository.com/artifact/commons-io/commons-io
        compile group: 'commons-io', name: 'commons-io', version: '2.6'

    }
}